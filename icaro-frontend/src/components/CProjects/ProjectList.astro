---
import ProjectCard from "@/components/CProjects/ProjectCard.astro";
import ProjectAdd from "@/components/CProjects/modals/ProjectAdd.astro";
import ProjectEdit from "@/components/CProjects/modals/ProjectEdit.astro";
import ProjectDelete from "@/components/CProjects/modals/ProjectDelete.astro";
import SearchFilter from "@/components/CCommon/SearchFilter.astro";
import Loader from "@/components/CCommon/Loader.astro"; 
import type { Project } from "@/types/project";

interface Props {
  projects: Project[];
}

const { projects } = Astro.props;
const hasQuery = Astro.url.searchParams.has("query");
const initialLoaderText = projects.length > 0 
  ? "Conectando..." 
  : (hasQuery ? "No se encontraron resultados" : "No hay proyectos disponibles");
---

<div id="projects-page-wrapper" class="relative min-h-[400px]">
  
  <Loader 
    id="project-list-loader" 
    text={initialLoaderText}
  />

  <ProjectAdd />

  <div class="w-full max-w-custom mb-6 relative z-[60]">
    <SearchFilter
      inputId="project-search"
      placeholder="Buscar proyectos por título..."
      baseURL={Astro.url.pathname}
    />
  </div>

  <div id="content-area" class="transition-opacity duration-500 opacity-0">
    {
      projects.length > 0 && (
        <div id="project-list-container" class="space-y-6">
          {projects.map((projectItem) => (
            <article class="project-card-item" data-project-id={projectItem.id}>
              <ProjectCard Project={projectItem} />
            </article>
          ))}
        </div>
      )
    }
  </div>

  <ProjectEdit />
  <ProjectDelete />
</div>

<script>
  import { initProjectList } from "@/utils/projects/projectListUtils";

  // Lógica delegada al util
  document.addEventListener("DOMContentLoaded", () => {
    initProjectList();
  });
</script>

<style>
  .space-y-6 > * + * { margin-top: 1.5rem; }
  .max-w-custom { max-width: 1200px; }
</style>