---
import ResearchEdit from './ResearchEdit.astro';
import ResearchDelete from './ResearchDelete.astro';

export interface Props {
  work: {
    id: string;
    putCode: string;
    title: string;
    description?: string;
    participants?: string[];
    externalIds?: string[];
    ownerOrcids?: string[];
    projectDate: string;
    projectName?: string;
    tags: string[];
  };
  year: string;
  isAdmin?: boolean;
}

const { work, year, isAdmin } = Astro.props;
// Generar un ID único para esta card
const cardId = `card-${work.id || work.putCode}`;
---

<article
  id={cardId}
  class="publication-entry border rounded-lg p-6 shadow-sm bg-white transition-all duration-300 hover:shadow-md relative"
  data-tags={work.tags.join(",")}
  data-project-name={work.projectName || ""}
  data-year={year}
>
  <!-- Botones de acción en la esquina superior derecha -->
  <div class="absolute top-3 right-3 flex flex-col gap-2">
   <ResearchEdit work={work} cardId={cardId} isAdmin={isAdmin} />
   <ResearchDelete work={work} cardId={cardId} isAdmin={isAdmin} />
  </div>

  <!-- Tags y proyecto -->
  <div class="flex flex-wrap gap-2 mb-3">
    {work.tags.map((tag) => (
      <span class="bg-gray-50 text-gray-800 text-xs px-2 py-1 rounded font-medium border border-gray-200 shadow-sm">
        {tag}
      </span>
    ))}
    {work.projectName && work.projectName.trim() !== "" && (
      <span class="bg-[#effdf5] text-[#1D293D] text-xs px-2 py-1 rounded font-medium border border-[#BFE5D1] shadow-sm">
        {work.projectName}
      </span>
    )}
  </div>

  <!-- Título -->
  <h3 class="text-xl font-bold text-gray-900 leading-snug mb-2">
    {work.title}
  </h3>

  <!-- Participantes -->
  {work.participants?.length > 0 && (
    <p class="text-sm text-gray-700 mb-1">
      {work.participants.join(", ")}
    </p>
  )}

  <!-- DOI -->
  {work.externalIds?.length > 0 && (
    <p class="text-sm italic text-gray-600">
      DOI: {work.externalIds[0]}
    </p>
  )}

  <!-- Año de publicación -->
  <p class="text-sm italic text-gray-600">Publicado en: {year}</p>

  <!-- Botón BibTeX -->
  <button
    class="mt-4 bg-gray-100 text-gray-800 text-xs px-3 py-1 rounded hover:bg-gray-200 transition"
    type="button"
  >
    BibTeX
  </button>
</article>

<style>
  .publication-entry {
    transition: box-shadow 0.3s ease;
  }
</style>