---
---
<div class="bg-slate-800 text-slate-200 text-xs">
  <div class="container mx-auto px-4 flex justify-end gap-4 py-1">
    <a href="/lang" class="hidden sm:inline">ES</a>
    <button id="adminToggle" class="cursor-pointer bg-transparent border-none text-inherit">Admin</button>
  </div>
</div>

<script is:inline>
document.addEventListener('DOMContentLoaded', () => {
  const adminToggle = document.getElementById('adminToggle');
  
  // Función para verificar el estado admin
  async function checkAdminStatus() {
    try {
      const response = await fetch('http://localhost:8080/api/session/check-admin', {
        credentials: 'include'
      });
      
      if (response.ok) {
        const isAdmin = await response.json();
        updateUI(isAdmin);
      }
    } catch (error) {
      console.error('Error checking admin status:', error);
    }
  }
  
  // Función para alternar el modo admin
  async function toggleAdmin() {
    try {
      const response = await fetch('http://localhost:8080/api/session/toggle-admin', {
        method: 'POST',
        credentials: 'include'
      });
      
      if (response.ok) {
        const isAdmin = await response.json();
        
        // 1. Actualizar UI inmediatamente para feedback visual rápido
        updateUI(isAdmin);
        
        // 2. Disparar evento personalizado para que otros componentes se actualicen
        window.dispatchEvent(new CustomEvent('adminStatusChanged', {
          detail: { isAdmin: isAdmin }
        }));
        
        // 3. Recargar después de un pequeño delay para que Astro 
        //    regenere todos los componentes con el estado correcto
        setTimeout(() => {
          window.location.reload();
        }, 100);
      }
    } catch (error) {
      console.error('Error toggling admin mode:', error);
    }
  }
  
  // Función para actualizar la UI
  function updateUI(isAdmin) {
    adminToggle.textContent = isAdmin ? 'Close Admin' : 'Admin';
    
    // Mostrar/ocultar elementos de edición
    document.querySelectorAll('.edit-btn').forEach(btn => {
      btn.classList.toggle('hidden', !isAdmin);
    });
    
    // Cerrar modales si salimos del modo admin
    if (!isAdmin) {
      document.querySelectorAll('.modal-container').forEach(modal => {
        modal.classList.add('hidden');
      });
    }
  }
  
  // Event listeners
  adminToggle.addEventListener('click', toggleAdmin);
  
  // Verificar estado al cargar
  checkAdminStatus();
});
</script>