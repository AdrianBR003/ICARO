---
import NewsCard from "@/components/CNews/NewsCard.astro";
import NewsAdd from "@/components/CNews/modals/NewsAdd.astro";
import NewsEdit from "@/components/CNews/modals/NewsEdit.astro";
import NewsDelete from "@/components/CNews/modals/NewsDelete.astro";
import SearchFilter from "@/components/CCommon/SearchFilter.astro";
import Loader from "@/components/CCommon/Loader.astro"; 
import type { News } from "@/types/news";

interface Props {
  news: News[];
}

const { news } = Astro.props;
const hasQuery = Astro.url.searchParams.has("query");

const initialLoaderText = news.length > 0 
  ? "Conectando..." 
  : (hasQuery ? "No se encontraron resultados" : "No hay noticias disponibles");
---

<div id="news-page-wrapper" class="relative min-h-[400px]">
  
  <Loader 
    id="news-list-loader" 
    text={initialLoaderText}
  />

  <NewsAdd />

  <div class="w-full max-w-custom mb-6 relative z-[60]">
    <SearchFilter
      inputId="news-search"
      placeholder="Buscar noticias por título o descripción..."
      baseURL={Astro.url.pathname}
    />
  </div>

  <div id="content-area" class="transition-opacity duration-500 opacity-0">
    {
      news.length > 0 && (
        <div id="news-list-container" class="space-y-4">
          {news.map((newsItem) => (
            <article class="news-card-item" data-news-id={newsItem.id}>
              <NewsCard news={newsItem} />
            </article>
          ))}
        </div>
      )
    }
  </div>

  <NewsEdit />
  <NewsDelete />
</div>

<script>
  import { initNewsList } from "@/utils/news/newsListUtils";

  document.addEventListener("DOMContentLoaded", () => {
    initNewsList();
  });
</script>

<style>
  .space-y-4 > * + * { margin-top: 1rem; }
  .max-w-custom { max-width: 1200px; }
</style>