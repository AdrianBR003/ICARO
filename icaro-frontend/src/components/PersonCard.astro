---
const { person } = Astro.props;
const modalId = `modal-${person.orcid}`;
---

<div class="person-card bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-all duration-300 relative">
  <!-- Botón de edición (solo visible en modo admin) -->
  <button 
    class="edit-btn hidden absolute top-3 right-3 z-10 p-2 rounded-full bg-white/90 hover:bg-gray-100 transition-colors shadow-sm"
    onclick={`document.dispatchEvent(new CustomEvent('editPerson', {detail: ${JSON.stringify(person)}}))`}
    aria-label="Editar"
  >
    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-600" viewBox="0 0 20 20" fill="currentColor">
      <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
    </svg>
  </button>

  
  <!-- Contenido principal -->
  <div class="p-6 flex flex-col gap-4">
    <div class="flex items-center gap-4">
      <img
        src={person.img || "/assets/people/default.jpg"}
        alt={`Foto de ${person.name}`}
        class="w-16 h-16 rounded-full object-cover border-2 border-gray-100"
        loading="lazy"
      />
      <div>
        <h3 class="text-lg font-semibold text-gray-800">{person.name}</h3>
        {person.role && <p class="text-sm text-gray-500">{person.role}</p>}
      </div>
    </div>

    <div class="space-y-2 text-sm">
      {person.email && (
        <p class="flex items-center gap-2 text-gray-600">
          <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
            <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z" />
            <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" />
          </svg>
          {person.email}
        </p>
      )}

      {person.phone && (
        <p class="flex items-center gap-2 text-gray-600">
          <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M7 2a2 2 0 00-2 2v12a2 2 0 002 2h6a2 2 0 002-2V4a2 2 0 00-2-2H7zm3 14a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
          </svg>
          {person.phone}
        </p>
      )}
    </div>
  </div>

  <!-- Modal de edición -->
  <div id={modalId} class="modal hidden fixed inset-0 z-50 flex items-center justify-center p-4">
    <div class="modal-overlay absolute inset-0 bg-black/50" onclick={`hideModal('${modalId}')`}></div>
    
    <div class="modal-content relative bg-white rounded-lg shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto">
      <div class="p-6">
        <h3 class="text-xl font-bold mb-4">Editar {person.name}</h3>
        
        <form class="space-y-4">
          <div>
            <label class="block mb-1 text-sm font-medium">Nombre</label>
            <input
              type="text"
              value={person.name}
              class="w-full px-3 py-2 border rounded-md"
            />
          </div>
          
          <div>
            <label class="block mb-1 text-sm font-medium">Email</label>
            <input
              type="email"
              value={person.email || ''}
              class="w-full px-3 py-2 border rounded-md"
            />
          </div>
          
          <div class="flex gap-4 pt-4">
            <button
              type="button"
              onclick={`hideModal('${modalId}')`}
              class="px-4 py-2 border rounded-md hover:bg-gray-50"
            >
              Cancelar
            </button>
            <button
              type="submit"
              class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700"
            >
              Guardar
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<style is:global>
  .modal {
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s ease;
  }
  
  .modal:not(.hidden) {
    opacity: 1;
    pointer-events: auto;
  }
  
  .modal-content {
    transform: translateY(20px);
    transition: transform 0.2s ease;
  }
  
  .modal:not(.hidden) .modal-content {
    transform: translateY(0);
  }
</style>